# Analysis Worker - Docker Environment Configuration
# Environment for Production
NODE_ENV=production

# Worker Identification (will be overridden by docker-compose for each instance)
WORKER_ID=worker-default

# RabbitMQ Configuration (Docker)
RABBITMQ_URL=amqp://admin:admin123@rabbitmq:5672
RABBITMQ_USER=admin
RABBITMQ_PASSWORD=admin123
QUEUE_NAME=assessment_analysis
EXCHANGE_NAME=atma_exchange
ROUTING_KEY=analysis.process
DEAD_LETTER_QUEUE=assessment_analysis_dlq

# Queue Configuration
QUEUE_DURABLE=true
MESSAGE_PERSISTENT=true

# Google Generative AI Configuration
GOOGLE_AI_API_KEY=AIzaSyCa6n8UP9x_RQniog0q3lzyPmFkRgZs4F4
GOOGLE_AI_MODEL=gemini-2.5-flash
AI_TEMPERATURE=0.4

# Mock AI Configuration - ENABLED FOR TESTING
USE_MOCK_MODEL=true

# Token Counting Configuration
ENABLE_TOKEN_COUNTING=true
TOKEN_USAGE_RETENTION_DAYS=30
INPUT_TOKEN_PRICE_PER_1K=0.30
OUTPUT_TOKEN_PRICE_PER_1K=2.50
TOKEN_COUNT_TIMEOUT=5000
ENABLE_TOKEN_COUNT_FALLBACK=true

# Internal Service Communication Key
INTERNAL_SERVICE_KEY=internal_service_secret_key_change_in_production

# Service URLs (Docker container names)
ARCHIVE_SERVICE_URL=http://archive-service:3002
NOTIFICATION_SERVICE_URL=http://notification-service:3005
ASSESSMENT_SERVICE_URL=http://assessment-service:3003

# Worker Configuration
WORKER_CONCURRENCY=5
MAX_RETRIES=3
RETRY_DELAY=5000
PROCESSING_TIMEOUT=1800000
HEARTBEAT_INTERVAL=300000

# Logging Configuration
LOG_LEVEL=info
LOG_FILE=logs/analysis-worker.log

# Database Optimization Configuration
DB_BATCH_SIZE=10
DB_BATCH_INTERVAL=5000
HTTP_KEEP_ALIVE=true
HTTP_MAX_SOCKETS=50
HTTP_MAX_FREE_SOCKETS=10

# Rate Limiting Configuration
RATE_LIMIT_USER_HOUR=5
RATE_LIMIT_IP_HOUR=20
RATE_LIMIT_GLOBAL_MINUTE=100

# Job Deduplication Configuration
JOB_CACHE_RETENTION_MS=3600000
MAX_JOB_CACHE_SIZE=10000

# Audit Logging Configuration
AUDIT_LOG_DIR=logs/audit
AUDIT_ENCRYPTION_KEY=your_audit_encryption_key_here
AUDIT_RETENTION_DAYS=2555

# Token Refund Configuration
ENABLE_TOKEN_REFUND=true
REFUND_PROCESSING_INTERVAL=5000

# ===== AI TIMEOUT & ERROR HANDLING =====
# AI request timeout (default: 5 minutes) - bisa diperpanjang jika perlu
AI_REQUEST_TIMEOUT=300000
# AI rate limiting (default: 15 requests per minute)
AI_RATE_LIMIT_RPM=15
AI_MAX_RETRIES=5
AI_RETRY_BASE_DELAY=2000

# ===== RABBITMQ MESSAGE TTL & TIMEOUTS =====
# Message TTL - berapa lama message bertahan di queue (default: 1 hour)
MESSAGE_TTL=3600000
# Queue TTL - berapa lama queue kosong bertahan (default: 24 hours)
QUEUE_TTL=86400000
# Message processing timeout (default: 30 minutes)
MESSAGE_TIMEOUT=1800000
# Queue limits
QUEUE_MAX_LENGTH=10000
DLQ_MAX_LENGTH=1000

# ===== JOB HEARTBEAT CONFIGURATION =====
# Heartbeat interval untuk long-running jobs (default: 30 seconds)
HEARTBEAT_INTERVAL=30000
# Maximum age untuk heartbeats sebelum cleanup (default: 1 hour)
MAX_HEARTBEAT_AGE=3600000
# Heartbeat cleanup interval (default: 10 minutes)
HEARTBEAT_CLEANUP_INTERVAL=600000

# ===== DLQ MONITORING =====
# DLQ monitoring interval (default: 5 minutes)
DLQ_MONITOR_INTERVAL=300000
# Alert threshold untuk DLQ message count (default: 10)
DLQ_ALERT_THRESHOLD=10

# ===== JOB CLEANUP CONFIGURATION =====
# Berapa lama jobs boleh stuck di processing sebelum cleanup (default: 1 hour)
JOB_CLEANUP_PROCESSING_HOURS=1
# Berapa lama jobs boleh queued sebelum cleanup (default: 24 hours)
JOB_CLEANUP_QUEUED_HOURS=24
# Job cleanup scheduler interval (default: 1 hour)
JOB_CLEANUP_INTERVAL=3600000
